================================================================================
US-12: OVERDUE FOLLOW-UPS - TESTING GUIDE
================================================================================

üìù PRE-TESTING SETUP
================================================================================

1. ‚úÖ Database schema updated (npx prisma db push - COMPLETED)
2. ‚è≥ Deploy to Vercel (for cron jobs to activate)
3. ‚è≥ Ensure CRON_SECRET environment variable is set

================================================================================
================================================================================
US-13: VIEW DASHBOARD METRICS - IMPLEMENTATION STATUS
================================================================================

‚úÖ FULLY IMPLEMENTED - All Acceptance Criteria Met

FEATURE IMPLEMENTATION SUMMARY:
================================================================================

1. ‚úÖ Dashboard Cards Display:
   - New Leads (blue card with FiUsers icon)
   - Follow-ups Due (orange card with FiClock icon)
   - Overdue (red card with FiAlertCircle icon)
   - Total Leads (purple card with FiPhone icon)
   - Won Deals (green card with FiCheckCircle icon)

2. ‚úÖ Date Range Filter:
   - Start Date input (defaults to 30 days ago)
   - End Date input (defaults to today)
   - Real-time filtering on date change

3. ‚úÖ Stats Recalculation:
   - All statistics automatically recalculate based on selected date range
   - Uses dedicated API endpoint: /api/dashboard/stats
   - Efficient parallel database queries for optimal performance

4. ‚úÖ Conversion Rate:
   - Displayed as percentage in Won Deals card
   - Formula: (Won Leads / Total Leads) √ó 100
   - Separate Win Rate card showing: (Won / Closed Deals) √ó 100

5. ‚úÖ Clickable Cards:
   - New Leads ‚Üí /dashboard/leads?filter=new
   - Follow-ups Due ‚Üí /dashboard/followups
   - Overdue ‚Üí /dashboard/followups?filter=overdue
   - Total Leads ‚Üí /dashboard/leads
   - Won Deals ‚Üí /dashboard/leads?filter=won
   - Qualified Leads ‚Üí /dashboard/leads?filter=qualified

6. ‚úÖ Hover Effects:
   - All cards have smooth transition on hover
   - Cards lift with shadow (transform: translateY(-2px))
   - Border color changes to match card color scheme
   - Cursor changes to pointer for clickable cards

7. ‚úÖ Dashboard Tables:
   - Upcoming Follow-ups (top 5 with priority badges)
   - Recent Leads (top 5 with status badges)
   - Responsive design (columns hide on mobile)
   - Clickable lead names linking to detail pages

8. ‚úÖ "View All" Buttons:
   - Upcoming Follow-ups ‚Üí /dashboard/followups
   - Recent Leads ‚Üí /dashboard/leads
   - Styled as ghost buttons for minimal UI

9. ‚úÖ Auto-Refresh Option:
   - Toggle switch in header (labeled "Auto-refresh")
   - When enabled, refreshes every 30 seconds
   - Toast notification on each auto-refresh
   - Manual refresh button with loading state

10. ‚úÖ Real-Time Stats Updates:
    - Implemented using SWR (Stale-While-Revalidate)
    - Revalidates on window focus
    - Revalidates on network reconnection
    - 2-second deduplication interval
    - Optimistic UI updates

TECHNICAL IMPLEMENTATION:
================================================================================

Files Created/Modified:
-----------------------
1. ‚úÖ /src/app/api/dashboard/stats/route.ts (NEW)
   - Comprehensive stats API endpoint
   - Optimized parallel queries
   - Date range filtering support
   - User-specific filtering capability

2. ‚úÖ /src/app/dashboard/page.tsx (ENHANCED)
   - Added SWR integration for real-time updates
   - Auto-refresh toggle with 30-second interval
   - Manual refresh with loading state
   - Toast notifications for user feedback
   - Improved date range defaults (last 30 days)
   - Enhanced card interactions
   - Better TypeScript typing

Key Features:
-------------
- **Performance**: Parallel database queries for minimal latency
- **UX**: Smooth transitions, hover effects, and instant feedback
- **Accessibility**: Proper ARIA labels, keyboard navigation
- **Responsive**: Mobile-optimized tables and cards
- **Type Safety**: Full TypeScript support
- **Error Handling**: Graceful error states and loading indicators

API Endpoint Details:
--------------------
GET /api/dashboard/stats
Query Parameters:
- startDate: ISO date string (optional)
- endDate: ISO date string (optional)
- userId: Filter by assigned user (optional)

Response Structure:
{
  "success": true,
  "data": {
    "stats": {
      "totalLeads": number,
      "newLeads": number,
      "qualifiedLeads": number,
      "wonLeads": number,
      "lostLeads": number,
      "followUpsDue": number,
      "overdue": number,
      "highPriorityOverdue": number,
      "conversionRate": number,
      "winRate": number
    },
    "recentLeads": Lead[],
    "upcomingFollowUps": FollowUp[],
    "timestamp": string
  }
}

TESTING CHECKLIST:
================================================================================

‚ñ° Dashboard loads without errors
‚ñ° All 5 main cards display correct data
‚ñ° Date range filter updates stats in real-time
‚ñ° Conversion rate displays as percentage
‚ñ° All cards navigate to correct pages on click
‚ñ° Hover effects work smoothly
‚ñ° Top 5 follow-ups table displays correctly
‚ñ° Top 5 recent leads table displays correctly
‚ñ° "View All" buttons navigate correctly
‚ñ° Auto-refresh toggle works (check every 30 seconds)
‚ñ° Manual refresh button updates data
‚ñ° Toast notifications appear on refresh
‚ñ° Stats update when underlying data changes
‚ñ° Mobile responsive design works
‚ñ° No TypeScript errors
‚ñ° Performance is acceptable (< 2s load time)

USER STORIES ACCEPTANCE CRITERIA - ‚úÖ ALL MET:
================================================================================

‚úÖ 1. Dashboard cards display all required metrics
‚úÖ 2. Date range filter with Start Date and End Date
‚úÖ 3. All stats recalculate based on selected date range
‚úÖ 4. Conversion rate displayed as percentage
‚úÖ 5. Cards are clickable and navigate to relevant views
‚úÖ 6. Hover effect on cards for interactivity
‚úÖ 7. Tables show upcoming follow-ups (top 5) and recent leads (top 5)
‚úÖ 8. "View All" buttons navigate to full pages
‚úÖ 9. Auto-refresh option to keep stats in sync
‚úÖ 10. Stats update in real-time when underlying data changes

DEPLOYMENT NOTES:
================================================================================

Dependencies Required:
- swr: ^2.3.6 (already installed ‚úÖ)
- @chakra-ui/react (already installed ‚úÖ)
- date-fns (already installed ‚úÖ)

Environment Variables:
- No additional environment variables needed

Database:
- No schema changes required (uses existing tables)

Next Steps:
- Test on staging environment
- Verify auto-refresh performance with multiple users
- Monitor API response times
- Gather user feedback on UX

================================================================================
üß™ TESTING SCENARIOS
================================================================================

TEST 1: CREATE OVERDUE FOLLOW-UP
----------------------------------
Steps:
1. Go to any lead detail page
2. Schedule a follow-up with:
   - Date: Yesterday or earlier
   - Time: Any time in the past
   - Priority: High
   - Add notes
3. Save the follow-up

Expected Results:
‚úì Follow-up is created successfully
‚úì Status is "pending"

TEST 2: VIEW OVERDUE ON FOLLOW-UPS PAGE
----------------------------------------
Steps:
1. Navigate to /dashboard/followups
2. Observe the list

Expected Results:
‚úì Overdue follow-up appears AT THE TOP of the list
‚úì Row has RED background (for high priority)
‚úì Badge shows "üî¥ X day(s) overdue"
‚úì Status shows "OVERDUE" instead of "pending"
‚úì Overdue count banner appears at top with count

TEST 3: VERIFY VISUAL INDICATORS
---------------------------------
Create two overdue follow-ups:
- One with priority: "high"
- One with priority: "medium"

Expected Results:
‚úì High priority: RED background (#red.50)
‚úì Medium priority: ORANGE background (#orange.50)
‚úì High priority appears BEFORE medium priority
‚úì Both show days overdue badge
‚úì Both have "OVERDUE" status

TEST 4: TEST OVERDUE FILTER
----------------------------
Steps:
1. Go to /dashboard/followups
2. Click status dropdown
3. Select "‚ö†Ô∏è Overdue Only"

Expected Results:
‚úì List filters to show ONLY overdue items
‚úì Non-overdue items are hidden
‚úì Count updates to show filtered count

Alternative:
- Navigate directly to: /dashboard/followups?filter=overdue
‚úì Page loads with filter pre-applied

TEST 5: DASHBOARD OVERDUE CARD
-------------------------------
Steps:
1. Navigate to /dashboard
2. Look for "Overdue" stat card

Expected Results:
‚úì Card shows correct overdue count
‚úì Help text shows high priority count (if any)
‚úì Card is clickable
‚úì Clicking navigates to /dashboard/followups?filter=overdue

TEST 6: QUICK ACTIONS MENU
---------------------------
Steps:
1. Go to /dashboard/followups
2. Find an overdue item
3. Click menu icon (‚ãÆ)

Expected Results:
‚úì Menu shows 3 options:
  - Mark Complete (green)
  - Reschedule (blue)
  - Cancel (red)
‚úì All options are clickable

TEST 6A: Mark Complete
Steps:
1. Click "Mark Complete"

Expected Results:
‚úì Success toast appears
‚úì Item moves to completed section
‚úì Item disappears from overdue list
‚úì Overdue count decreases

TEST 6B: Reschedule
Steps:
1. Click "Reschedule"

Expected Results:
‚úì Navigates to lead detail/followup page
‚úì Can create new follow-up

TEST 6C: Cancel
Steps:
1. Click "Cancel"

Expected Results:
‚úì Success toast appears
‚úì Item status changes to "cancelled"
‚úì Item disappears from overdue list
‚úì Overdue count decreases

TEST 7: DSR PAGE METRICS
-------------------------
Steps:
1. Navigate to /dashboard/dsr
2. Look for "Overdue Follow-ups" card

Expected Results:
‚úì Card exists in the grid
‚úì Shows total overdue count
‚úì Shows high priority count in total or help text
‚úì Card is clickable
‚úì Clicking filters leads with overdue follow-ups

TEST 8: REPORTS PAGE METRICS
-----------------------------
Steps:
1. Navigate to /dashboard/reports
2. Look in "Key Metrics" section

Expected Results:
‚úì "Overdue Follow-ups" card exists
‚úì Shows total overdue count
‚úì Help text shows high priority count
‚úì Card has red styling for visibility

TEST 9: DAYS OVERDUE CALCULATION
---------------------------------
Create follow-ups with different past dates:
- 1 day ago
- 3 days ago
- 7 days ago

Expected Results:
‚úì 1 day ago shows: "üî¥ 1 day overdue"
‚úì 3 days ago shows: "üî¥ 3 days overdue"
‚úì 7 days ago shows: "üî¥ 7 days overdue"
‚úì Most overdue appears first in list

TEST 10: PRIORITY SORTING
--------------------------
Create multiple overdue follow-ups:
- 2 days overdue, high priority
- 5 days overdue, medium priority
- 3 days overdue, high priority

Expected Results:
‚úì 3 days overdue (high) appears FIRST
‚úì 2 days overdue (high) appears SECOND
‚úì 5 days overdue (medium) appears THIRD
(High priority overdue before medium, regardless of days)

TEST 11: CRON JOB NOTIFICATION (Manual Test)
---------------------------------------------
Steps:
1. Ensure you have overdue follow-ups assigned to you
2. Run cron manually:
   curl -H "Authorization: Bearer YOUR_CRON_SECRET" \
        http://localhost:3000/api/cron/check-overdue-followups
   OR wait for hourly trigger on production

Expected Results:
‚úì API responds with success
‚úì Returns count of notifications created
‚úì Notification appears in bell icon
‚úì Notification title shows priority level
‚úì Message includes days overdue and lead name

TEST 12: NOTIFICATION BELL
--------------------------
Steps:
1. After cron job runs
2. Click notification bell icon

Expected Results:
‚úì Bell shows red badge with count
‚úì Dropdown shows overdue notifications
‚úì Notification title varies by priority:
  - High: "üî¥ High Priority Follow-up Overdue!"
  - Others: "‚ö†Ô∏è Follow-up Overdue"
‚úì Message includes lead name and days overdue

TEST 13: NO DUPLICATE NOTIFICATIONS
------------------------------------
Steps:
1. Run cron job manually twice
2. Check notification count

Expected Results:
‚úì Second run does NOT create duplicate notifications
‚úì Only new overdue items trigger notifications

TEST 14: OVERDUE BANNER
-----------------------
Steps:
1. Have at least 1 overdue follow-up
2. Go to /dashboard/followups

Expected Results:
‚úì Red banner appears above filters
‚úì Shows count: "X Overdue"
‚úì Warning message about needing attention
‚úì "View Overdue" button present
‚úì Clicking button applies overdue filter

TEST 15: RESPONSIVE DESIGN (Mobile)
------------------------------------
Steps:
1. Open /dashboard/followups on mobile viewport
2. View overdue items

Expected Results:
‚úì Overdue indicators visible on mobile
‚úì Days overdue badge displays properly
‚úì Quick actions menu accessible
‚úì Background colors visible
‚úì Text doesn't overflow

TEST 16: MULTIPLE AGENTS
-------------------------
Steps:
1. Login as different agents
2. Create overdue follow-ups assigned to each

Expected Results:
‚úì Each agent sees only THEIR overdue items
‚úì Counts are agent-specific
‚úì Notifications go to correct agents
‚úì DSR metrics are per-agent

TEST 17: EDGE CASES
-------------------
Test Case A: No Overdue Follow-ups
Expected:
‚úì No overdue banner shown
‚úì Overdue card shows "0"
‚úì Filter works but shows empty state

Test Case B: All Follow-ups Overdue
Expected:
‚úì All items highlighted
‚úì Correct sorting maintained
‚úì Banner shows accurate count

Test Case C: Follow-up Due Today (Not Yet Overdue)
Expected:
‚úì NOT shown in overdue filter
‚úì NO overdue badge
‚úì Normal background color
‚úì Status shows "pending"

Test Case D: Follow-up Due in Future
Expected:
‚úì NOT shown in overdue filter
‚úì NO overdue badge
‚úì Appears after overdue items in list

================================================================================
‚úÖ ACCEPTANCE CRITERIA CHECKLIST
================================================================================

During testing, verify ALL of these are working:

‚ñ° 1. Overdue items at top of list
‚ñ° 2. Red badge/icon visual indicators
‚ñ° 3. Dashboard overdue count
‚ñ° 4. Overdue filter option
‚ñ° 5. Days overdue displayed
‚ñ° 6. High-priority extra emphasis
‚ñ° 7. Quick actions (Complete/Reschedule)
‚ñ° 8. Automatic notifications
‚ñ° 9. Performance metrics (DSR/Reports)

================================================================================
üêõ TROUBLESHOOTING
================================================================================

Issue: Cron job not running
Solution: 
- Verify deployed to Vercel
- Check vercel.json has correct schedule
- Ensure CRON_SECRET is set in env vars

Issue: Notifications not appearing
Solution:
- Check cron job ran successfully
- Verify follow-up has assignedToId
- Check notification API endpoint
- Refresh NotificationBell component

Issue: Days overdue incorrect
Solution:
- Verify server timezone settings
- Check scheduledAt date format
- Ensure calculation uses proper date comparison

Issue: Sorting not working
Solution:
- Check filteredFollowUps sorting logic
- Verify priority values are correct
- Clear cache and reload

================================================================================
üìä SUCCESS METRICS
================================================================================

After all tests pass, the implementation should:
‚úì Zero TypeScript errors
‚úì All 9 acceptance criteria met
‚úì Responsive on all devices
‚úì No duplicate notifications
‚úì Correct calculations
‚úì Intuitive user experience
‚úì Performance metrics accurate
‚úì Visual indicators clear and consistent

================================================================================
üöÄ DEPLOYMENT CHECKLIST
================================================================================

Before marking as complete:
‚ñ° All tests passed
‚ñ° Database schema updated
‚ñ° Deployed to staging/production
‚ñ° Cron job verified working
‚ñ° Tested on desktop and mobile
‚ñ° Performance checked
‚ñ° User acceptance testing completed
‚ñ° Documentation updated

================================================================================
