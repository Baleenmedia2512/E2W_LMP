generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model ActivityHistory {
  id          String   @id
  leadId      String
  userId      String
  action      String
  fieldName   String?
  oldValue    String?  @db.Text
  newValue    String?  @db.Text
  description String
  metadata    String?  @db.LongText
  createdAt   DateTime @default(now())
  Lead        Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  User        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([leadId])
  @@index([userId])
}

model AuditLog {
  id         String   @id
  userId     String
  action     String
  targetType String
  targetId   String
  changes    String?  @db.LongText
  metadata   String?  @db.LongText
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())

  @@index([createdAt])
  @@index([targetType])
  @@index([userId])
}

model CallLog {
  id                  String    @id
  leadId              String
  callerId            String
  startedAt           DateTime  @default(now())
  endedAt             DateTime?
  duration            Int?
  remarks             String?   @db.Text
  callStatus          String?
  attemptNumber       Int       @default(1)
  recordingUrl        String?
  customerRequirement String?
  metadata            String?   @db.LongText
  createdAt           DateTime  @default(now())
  User                User      @relation(fields: [callerId], references: [id], onDelete: Cascade)
  Lead                Lead      @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([callerId])
  @@index([createdAt])
  @@index([leadId])
}

model FollowUp {
  id                  String    @id
  leadId              String
  scheduledAt         DateTime
  completedAt         DateTime?
  notes               String?   @db.Text
  status              String    @default("pending")
  priority            String    @default("medium")
  createdById         String
  metadata            String?   @db.LongText
  createdAt           DateTime  @default(now())
  updatedAt           DateTime
  customerRequirement String?   @db.Text
  User                User      @relation(fields: [createdById], references: [id], onDelete: Cascade)
  Lead                Lead      @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([createdById])
  @@index([leadId])
  @@index([scheduledAt])
  @@index([status])
}

model Lead {
  id                           String            @id
  name                         String
  phone                        String
  email                        String?
  alternatePhone               String?
  address                      String?
  city                         String?
  state                        String?
  pincode                      String?
  source                       String
  campaign                     String?
  customerRequirement          String?
  status                       String            @default("new")
  priority                     String            @default("medium")
  notes                        String?           @db.LongText
  metadata                     String?           @db.LongText
  assignedToId                 String?
  createdById                  String?
  createdAt                    DateTime          @default(now())
  updatedAt                    DateTime
  callAttempts                 Int               @default(0)
  ActivityHistory              ActivityHistory[]
  CallLog                      CallLog[]
  FollowUp                     FollowUp[]
  User_Lead_assignedToIdToUser User?             @relation("Lead_assignedToIdToUser", fields: [assignedToId], references: [id])
  User_Lead_createdByIdToUser  User?             @relation("Lead_createdByIdToUser", fields: [createdById], references: [id])

  @@index([assignedToId])
  @@index([createdAt])
  @@index([createdById])
  @@index([source])
  @@index([status])
}

model Notification {
  id            String    @id
  userId        String
  type          String
  title         String
  message       String    @db.Text
  isRead        Boolean   @default(false)
  readAt        DateTime?
  metadata      String?   @db.LongText
  createdAt     DateTime  @default(now())
  relatedLeadId String?
  User          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([relatedLeadId])
  @@index([type])
  @@index([userId])
}

model Role {
  id          String   @id
  name        String   @unique
  description String?
  permissions String?  @db.LongText
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  User        User[]
}

model User {
  id                           String            @id
  name                         String?
  email                        String            @unique
  emailVerified                DateTime?
  image                        String?
  googleId                     String?           @unique
  password                     String?
  roleId                       String
  isActive                     Boolean           @default(true)
  createdAt                    DateTime          @default(now())
  updatedAt                    DateTime
  settings                     String?           @db.LongText
  ActivityHistory              ActivityHistory[]
  CallLog                      CallLog[]
  FollowUp                     FollowUp[]
  Lead_Lead_assignedToIdToUser Lead[]            @relation("Lead_assignedToIdToUser")
  Lead_Lead_createdByIdToUser  Lead[]            @relation("Lead_createdByIdToUser")
  Notification                 Notification[]
  Role                         Role              @relation(fields: [roleId], references: [id])

  @@index([email])
  @@index([roleId])
}
